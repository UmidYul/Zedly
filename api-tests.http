# Zedly API Tests
# Используйте расширение REST Client для VSCode
# https://marketplace.visualstudio.com/items?itemName=humao.rest-client

@baseUrl = http://167.235.222.200:3001/api/v1
@contentType = application/json

# Переменные (замените после получения токенов)
@accessToken = YOUR_ACCESS_TOKEN_HERE
@refreshToken = YOUR_REFRESH_TOKEN_HERE
@schoolId = YOUR_SCHOOL_ID_HERE
@classId = YOUR_CLASS_ID_HERE
@teacherId = YOUR_TEACHER_ID_HERE
@studentId = YOUR_STUDENT_ID_HERE

###############################################################################
# HEALTH CHECK
###############################################################################

### Health Check
GET http://167.235.222.200:3001/health

###############################################################################
# AUTHENTICATION
###############################################################################

### 1. Login as SuperAdmin
POST {{baseUrl}}/auth/login
Content-Type: {{contentType}}

{
  "username": "admin",
  "password": "Admin123!"
}

### 2. Login as School Admin
POST {{baseUrl}}/auth/login
Content-Type: {{contentType}}

{
  "username": "school1admin",
  "password": "Test123456"
}

### 3. Refresh Token
POST {{baseUrl}}/auth/refresh
Content-Type: {{contentType}}

{
  "refreshToken": "{{refreshToken}}"
}

### 4. Logout
POST {{baseUrl}}/auth/logout
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

### 5. Change Password
POST {{baseUrl}}/auth/password/change
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "oldPassword": "Admin123!",
  "newPassword": "NewPassword123!"
}

### 6. Forgot Password
POST {{baseUrl}}/auth/password/forgot
Content-Type: {{contentType}}

{
  "email": "admin@example.com"
}

### 7. Reset Password
POST {{baseUrl}}/auth/password/reset
Content-Type: {{contentType}}

{
  "token": "RESET_TOKEN_HERE",
  "newPassword": "NewPassword123!"
}

###############################################################################
# SUPERADMIN - SCHOOLS
###############################################################################

### 1. Get All Schools
GET {{baseUrl}}/superadmin/schools
Authorization: Bearer {{accessToken}}

### 2. Create School
POST {{baseUrl}}/superadmin/schools
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "name": "Школа №1 Ташкент",
  "adminUsername": "school1admin",
  "adminEmail": "admin@school1.uz",
  "adminPassword": "Test123456"
}

### 3. Update School
PUT {{baseUrl}}/superadmin/schools/{{schoolId}}
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "name": "Школа №1 Ташкент (Обновлено)",
  "status": "active"
}

### 4. Get School by ID
GET {{baseUrl}}/superadmin/schools/{{schoolId}}
Authorization: Bearer {{accessToken}}

###############################################################################
# SUPERADMIN - PLATFORM SETTINGS
###############################################################################

### 1. Get Platform Settings
GET {{baseUrl}}/superadmin/platform-settings
Authorization: Bearer {{accessToken}}

### 2. Update Platform Settings
PUT {{baseUrl}}/superadmin/platform-settings
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "passwordPolicy": {
    "minLength": 8,
    "requireUppercase": true,
    "requireLowercase": true,
    "requireNumber": true,
    "requireSpecial": false
  },
  "testDurationLimits": {
    "min": 5,
    "max": 180
  }
}

###############################################################################
# SUPERADMIN - AUDIT LOGS
###############################################################################

### Get Audit Logs
GET {{baseUrl}}/superadmin/audit-logs?limit=50&offset=0
Authorization: Bearer {{accessToken}}

###############################################################################
# ADMIN - TEACHERS
###############################################################################

### 1. Get All Teachers
GET {{baseUrl}}/admin/teachers
Authorization: Bearer {{accessToken}}

### 2. Create Teacher
POST {{baseUrl}}/admin/teachers
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "username": "ivanov_teacher",
  "email": "ivanov@school1.uz",
  "password": "Teacher123",
  "firstName": "Иван",
  "lastName": "Иванов",
  "subject": "Математика"
}

### 3. Update Teacher
PUT {{baseUrl}}/admin/teachers/{{teacherId}}
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "firstName": "Иван",
  "lastName": "Иванов",
  "subject": "Алгебра",
  "status": "active"
}

### 4. Delete Teacher
DELETE {{baseUrl}}/admin/teachers/{{teacherId}}
Authorization: Bearer {{accessToken}}

###############################################################################
# ADMIN - STUDENTS
###############################################################################

### 1. Get All Students
GET {{baseUrl}}/admin/students
Authorization: Bearer {{accessToken}}

### 2. Create Student
POST {{baseUrl}}/admin/students
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "username": "petrov_student",
  "email": "petrov@school1.uz",
  "password": "Student123",
  "firstName": "Петр",
  "lastName": "Петров",
  "dateOfBirth": "2008-05-15",
  "classId": "{{classId}}"
}

### 3. Create Student without Class
POST {{baseUrl}}/admin/students
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "username": "sidorova_student",
  "password": "Student123",
  "firstName": "Анна",
  "lastName": "Сидорова"
}

### 4. Update Student
PUT {{baseUrl}}/admin/students/{{studentId}}
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "firstName": "Петр",
  "lastName": "Петров",
  "classId": "{{classId}}",
  "status": "active"
}

### 5. Delete Student
DELETE {{baseUrl}}/admin/students/{{studentId}}
Authorization: Bearer {{accessToken}}

###############################################################################
# ADMIN - CLASSES
###############################################################################

### 1. Get All Classes
GET {{baseUrl}}/admin/classes
Authorization: Bearer {{accessToken}}

### 2. Create Class
POST {{baseUrl}}/admin/classes
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "name": "9А",
  "parallel": 9,
  "letter": "А"
}

### 3. Create Multiple Classes
POST {{baseUrl}}/admin/classes
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "name": "10Б",
  "parallel": 10,
  "letter": "Б"
}

### 4. Update Class
PUT {{baseUrl}}/admin/classes/{{classId}}
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "name": "9А (Математический)",
  "parallel": 9,
  "letter": "А"
}

### 5. Delete Class
DELETE {{baseUrl}}/admin/classes/{{classId}}
Authorization: Bearer {{accessToken}}

###############################################################################
# ADMIN - BULK IMPORT
###############################################################################

### 1. Import Students from CSV
# NOTE: Replace with actual file path
POST {{baseUrl}}/admin/import/students
Authorization: Bearer {{accessToken}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="students.csv"
Content-Type: text/csv

firstName,lastName,username,email,password,classId
Иван,Иванов,ivanov_bulk,ivanov_bulk@school1.uz,Password123,
Мария,Петрова,petrova_bulk,petrova_bulk@school1.uz,Password123,
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### 2. Import Teachers from CSV
# NOTE: Replace with actual file path
POST {{baseUrl}}/admin/import/teachers
Authorization: Bearer {{accessToken}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="teachers.csv"
Content-Type: text/csv

firstName,lastName,username,email,password,subject
Анна,Смирнова,smirnova_bulk,smirnova_bulk@school1.uz,Password123,Математика
Петр,Сидоров,sidorov_bulk,sidorov_bulk@school1.uz,Password123,Физика
------WebKitFormBoundary7MA4YWxkTrZu0gW--

###############################################################################
# TEST SCENARIOS
###############################################################################

### Scenario 1: Complete School Setup
# 1. Login as SuperAdmin
# 2. Create School
# 3. Login as School Admin
# 4. Create Classes (9А, 9Б, 10А)
# 5. Create Teachers
# 6. Create Students
# 7. Assign Students to Classes

### Scenario 2: Bulk Import
# 1. Login as School Admin
# 2. Create Class
# 3. Get Class ID
# 4. Import Students with classId
# 5. Verify Students Created

### Scenario 3: Update Flow
# 1. Get All Teachers
# 2. Get Teacher ID
# 3. Update Teacher Info
# 4. Verify Update

###############################################################################
# ERROR TESTING
###############################################################################

### 1. Login with Invalid Credentials
POST {{baseUrl}}/auth/login
Content-Type: {{contentType}}

{
  "username": "invalid",
  "password": "wrong"
}

### 2. Create Teacher without Auth
POST {{baseUrl}}/admin/teachers
Content-Type: {{contentType}}

{
  "username": "test_teacher",
  "email": "test@example.com",
  "password": "Test123",
  "firstName": "Test",
  "lastName": "Teacher"
}

### 3. Create Duplicate Username
POST {{baseUrl}}/admin/students
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "username": "ivanov_student",
  "password": "Test123",
  "firstName": "Дубликат",
  "lastName": "Тест"
}

### 4. Delete Class with Students (should fail)
DELETE {{baseUrl}}/admin/classes/{{classId}}
Authorization: Bearer {{accessToken}}

### 5. Access Admin Endpoint as Teacher (should fail)
GET {{baseUrl}}/admin/students
Authorization: Bearer TEACHER_TOKEN_HERE

###############################################################################
# NOTES
###############################################################################

# 1. Установите расширение REST Client в VSCode
# 2. Замените переменные @accessToken, @schoolId и т.д. реальными значениями
# 3. Для файловых загрузок используйте curl или Postman
# 4. Первый request должен быть Login для получения токенов
# 5. Сохраните accessToken из response и используйте в последующих запросах

###############################################################################
# QUICK START
###############################################################################

# 1. Запустите "Login as SuperAdmin" -> скопируйте accessToken
# 2. Замените @accessToken на полученный токен
# 3. Запустите "Create School" -> скопируйте ID школы
# 4. Запустите "Login as School Admin" с credentials из Create School
# 5. Теперь можете создавать классы, учителей, учеников
